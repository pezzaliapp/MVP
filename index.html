<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
  <title>Preventivo PRO — Quoting & Margini (PWA)</title>
  <meta name="theme-color" content="#0f172a">
  <link rel="manifest" href="./manifest.webmanifest">
  <link rel="icon" href="./icons/icon-192.png">
  <style>
    :root{--bg:#0b1022;--card:#111735;--ink:#f1f4ff;--muted:#9fb0d9;--cta:#22c55e;--line:#1d2a55}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font:15px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Arial;background:#0b1022;color:var(--ink)}
    header{position:sticky;top:0;z-index:10;background:rgba(11,16,34,.7);backdrop-filter:blur(8px);border-bottom:1px solid var(--line)}
    .bar{max-width:1200px;margin:0 auto;padding:12px 16px;display:flex;gap:10px;align-items:center}
    h1{font-size:18px;margin:0;font-weight:700}
    .tag{font-size:12px;padding:2px 8px;border:1px solid var(--line);border-radius:999px;color:var(--muted)}
    .btn{border:1px solid var(--line);background:#111834;color:var(--ink);padding:8px 12px;border-radius:8px;cursor:pointer}
    .btn-cta{background:var(--cta);border-color:#0e8a43;color:#07120c;font-weight:700}
    main{max-width:1200px;margin:16px auto;padding:0 12px 100px}
    .grid{display:grid;grid-template-columns:1fr 340px;gap:16px}
    .card{background:#111735;border:1px solid var(--line);border-radius:14px;box-shadow:0 3px 10px rgba(0,0,0,.3)}
    .card h2{margin:0;padding:12px 16px;border-bottom:1px solid var(--line);font-size:15px}
    .section{padding:12px 16px}
    label{font-size:12px;color:var(--muted)}
    input,select{width:100%;padding:8px 10px;margin-top:4px;background:#0f1836;border:1px solid var(--line);border-radius:8px;color:var(--ink);font-size:14px}

    /* tabella */
    table{width:100%;border-collapse:separate;border-spacing:0 6px}
    th{font-size:12px;color:var(--muted);text-align:left;padding:0 6px}
    td{padding:4px 6px;font-size:14px}
    tr.item{background:#0f1836;border:1px solid var(--line)}
    tr.item td:first-child{border-top-left-radius:8px;border-bottom-left-radius:8px}
    tr.item td:last-child{border-top-right-radius:8px;border-bottom-right-radius:8px}
    td input{width:100%;font-size:14px}
    td.right input{text-align:right}
    .right{text-align:right}

    /* col larghezze */
    th:nth-child(1), td:nth-child(1){width:120px} /* img */
    th:nth-child(2), td:nth-child(2){width:auto}  /* descrizione */
    th:nth-child(3), td:nth-child(3){width:110px} /* costo */
    th:nth-child(4), td:nth-child(4){width:110px} /* margine/ricarico */
    th:nth-child(5), td:nth-child(5){width:120px} /* prezzo */
    th:nth-child(6), td:nth-child(6){width:80px}  /* qty */
    th:nth-child(7), td:nth-child(7){width:90px}  /* sconto */
    th:nth-child(8), td:nth-child(8){width:40px}  /* del */

    .muted{color:var(--muted);font-size:13px}
    .mono{font-family:ui-monospace,monospace}
    .totals{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .pill{display:inline-flex;gap:6px;align-items:center;padding:6px 10px;border:1px solid var(--line);border-radius:999px;color:var(--muted);font-size:12px}
    footer{position:fixed;bottom:0;left:0;right:0;background:#111834;border-top:1px solid var(--line)}
    .foot{max-width:1200px;margin:0 auto;padding:8px 12px;display:flex;justify-content:space-between;align-items:center}
    .foot small{color:var(--muted)}

    @media(max-width:1000px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <header>
    <div class="bar">
      <h1>Preventivo PRO</h1>
      <span class="tag">PWA • Offline</span>
      <button id="installBtn" class="btn" hidden>Aggiungi alla Home</button>
      <div style="flex:1"></div>
      <button class="btn" id="importCsv">Importa CSV</button>
      <button class="btn" id="saveQuote">Salva</button>
      <button class="btn" id="printBtn">Stampa/PDF</button>
      <button class="btn btn-cta" id="unlockPro">Sblocca PRO</button>
    </div>
  </header>

  <main>
    <div class="grid">
      <section class="card">
        <h2>Dati cliente & preventivo</h2>
        <div class="section" style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
          <div><label>Cliente</label><input id="client" placeholder="Ragione sociale / Nome"></div>
          <div><label>Email</label><input id="email" placeholder="email@cliente.it" type="email"></div>
          <div><label>Oggetto</label><input id="subject" placeholder="Fornitura + installazione..."></div>
          <div><label>Validità</label>
            <select id="validDays"><option value="15">15 giorni</option><option value="30" selected>30 giorni</option><option value="60">60 giorni</option></select>
          </div>
        </div>

        <div class="section">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:6px">
            <strong>Voci di preventivo</strong>
            <button class="btn" id="addItem">+ Aggiungi riga</button>
          </div>
          <table>
            <thead>
              <tr>
                <th>Img</th><th>Descrizione</th><th class="right">Costo</th>
                <th class="right" id="thMargin">Margine %</th>
                <th class="right">Prezzo netto</th>
                <th class="right">Q.tà</th>
                <th class="right">Sconto %</th><th></th>
              </tr>
            </thead>
            <tbody id="items"></tbody>
          </table>
          <div class="pill" style="margin-top:6px"><span>CSV demo:</span><button class="btn" id="demoCsv">carica 3 righe</button></div>
        </div>
      </section>

      <aside class="card">
        <h2>Margini & Totali</h2>
        <div class="section">
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px">
            <div><label>IVA %</label><input id="vat" type="number" value="22"></div>
            <div><label>Spese (trasporto, installazione)</label><input id="extra" type="number" value="0"></div>
          </div>
          <div class="totals">
            <div class="card" style="padding:10px"><div class="muted">Ricavi netti</div><div class="mono" id="sumNetto" style="font-size:20px">€0,00</div><div class="muted">Margine assoluto</div><div class="mono" id="sumMargin">€0,00</div></div>
            <div class="card" style="padding:10px"><div class="muted">Totale imponibile</div><div class="mono" id="sumImponibile" style="font-size:20px">€0,00</div><div class="muted">Totale IVA inclusa</div><div class="mono" id="sumTotale">€0,00</div></div>
          </div>
          <div style="margin-top:10px">
            <div class="pill">Target margine medio %: <input id="targetMargin" type="number" value="30" style="width:70px;margin-left:6px"></div>
            <button class="btn" id="autoPrice" style="margin-top:6px">Suggerisci prezzi per target</button>
          </div>
        </div>
      </aside>
    </div>
  </main>

  <footer>
    <div class="foot"><small>© 2025 pezzaliAPP — MIT • Versione gratuita limitata a 1 preventivo</small><button class="btn" id="resetApp">Reset dati</button></div>
  </footer>

  <script src="./app.js"></script>
</body>
</html>
